<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <meta name="theme-color" content="#3cb3b7">
    <title>AAKHADA TIMER</title>
    <style>
        /* latin */
        @font-face {
        font-family: 'Abel';
        font-style: normal;
        font-weight: 400;
        src: url(MwQ5bhbm2POE2V9BPQ.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        /* Loading */
        #loadingOverlay {
            font-family: 'Abel';
            pointer-events: auto;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            /* Add the transition property */
            transition: opacity 0.5s ease-in;
            opacity: 1;
            /* Set initial opacity to 1 */
        }

        #loadingOverlay.fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        #loadingOverlay p {
            color: #fff;
            font-size: 300%;
            text-transform: uppercase;
            letter-spacing: 4px;
            animation: slideIn 2s ease-in-out infinite;
            white-space: nowrap;
        }

        @keyframes slideIn {
            0% {
                transform: translateX(-30%);
                opacity: 5%;
            }

            10% {
                opacity: 30%;
                transform: translateX(10%);
            }

            30% {
                opacity: 70%;
                transform: translateX(0);
            }

            100% {
                opacity: 100%;
                transform: translateX(0);
            }
        }

        #mainContent {
            /* Initial state */
            font-family: 'Abel';
            transition: opacity 0.5s ease-in;
            opacity: 0;
            /* Set initial opacity to 0 */
        }

        body {
            /* Green to cyan gradient */
            /* background: linear-gradient(to bottom right, #42e596, #3cb3b7); */
            background: linear-gradient(to bottom right, #ff0000, #000000);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Abel';

        }

        .timer-display {
            font-size: 200%;
            align-items: center;
            justify-content: center;
            display: flex;
        }

        .timer-info {
            color: white;
            /* Set the font color to white */
            opacity: 50%;


        }

        .timer-value {
            color: white;
            font-size: 400%;
        }

        .timer-state {
            color: white;
            opacity: 50%;
        }

        .timer-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            opacity: 50%;
        }

        .timer-button {
            background: none;
            border: none;
            color: white;
            font-size: 300%;
            margin-right: 10px;
            cursor: pointer;
            transition: transform 0.3s ease-in-out;
        }

        .timer-button:hover {
            transform: scale(1.2);
        }

        #repeat-icon:hover {
            color: #ff4081;
            /* Pink */
        }

        #play-icon:hover {
            color: #00bcd4;
            /* Cyan */
        }

        #pause-icon:hover {
            color: #ff9800;
            /* Orange */
        }

        #stop-icon:hover {
            color: #c34a4a;
            /* Green */
        }

        #settingsPanel {
            position:fixed;
            bottom: -100%;
            /* Initial position, off-screen */
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            background-color: rgba(0, 0, 0, 0.9);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border-radius: 20px 20px 0 0;
            transition: bottom 0.3s ease-in-out;
            z-index: 9999;
            color: #fff;
            border-width: 4px 0px 0 0px;
            border-color: #ccc;
            border-style: solid;
            padding: 20px;
        }

        #settingsPanel.open {
            bottom: 0;
            /* Position when panel is open */
        }

        /* The container <div> - needed to position the dropup content */
            .dropup {
                position: fixed;
                left: 44%;
                bottom: 70px;
                    /* width: 200px;
                    height: 40px; */
            }
            
            #startPresetButton {
                position: fixed;
                bottom: 70px;
                left: 50%;
                transform: translateX(-50%);
                width: 200px;
                height: 40px;
            }
        /* Dropup content (Hidden by Default) */
        .dropup-content {
            display: none;
            position: absolute;
            bottom: 42px;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            opacity: 0; /* Start with 0 opacity */
            transform: translateY(-10px); /* Start slightly above its position */
            transition: opacity 0.3s ease, transform 0.3s ease; /* Add transitions */
        }   

        /* Links inside the dropup */
        .dropup-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        /* Change color of dropup links on hover */
        .dropup-content a:hover {background-color: #ddd}

        /* Show the dropup menu on hover */
        .dropup:hover .dropup-content {
            display: block;
            opacity: 1; /* Fade-in the menu */
            transform: translateY(0); /* Move it to its original position */
        }

        /* Show the dropup menu on click */
        /* .dropup:focus .dropup-content {
            opacity: 1;
            height: auto;
            overflow: visible;
        } */

        /* Change the background color of the dropup button when the dropup content is shown */
        /* .dropup.click .startPresetButton {
            background-color: #2980B9;
        } */

        #settingsButton {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 40px;
        }
        .homebuttons {
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            z-index: 9999;
            border: 1px solid #ffffff;
            /* Set the border width and color */
            background: none;
            /* Remove the background color */
            padding: 10px 20px;
            /* Set the padding for the button */
        }

        input[type="text"],
        input[type="number"] {
            width: 20%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            opacity: 100%;
            color: #ccc;
            background-color: transparent;
            margin: 2px;
        }

        .select-dropdown {
            width: 96%;
            background-color: transparent;
            padding: 7px;
            border: 1px solid #ccc;
            border-radius: 10px;
            color: #ccc;
        }

        .select-dropdown select {
            appearance: none;
            outline: none;
            border: none;
            border-radius: 10px;
            background-color: transparent;
            width: 100%;
            cursor: pointer;
            padding-right: 25px;
            color: #ccc;
        }


        button[type="submit"] {
            display: block;
            width: 98%;
            padding: 10px;
            background-color: rgb(71, 166, 255);
            color: #fff;
            border: solid;
            border-color: #000;
            border-radius: 100px;
            cursor: pointer;
            opacity: 90%;
            margin: 10px auto;
        }
        .sequnceButtons{
            display: block;
            width: 50%;
            padding: 5px;
            background-color: rgb(71, 166, 255);
            color: #fff;
            border: solid;
            border-radius: 100px;
            border-color: transparent;
            cursor: pointer;
            opacity: 90%;
            margin: 15px auto;
            font-weight: bold;
        }

        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }

        .tabButtons {
            margin-left: -20px;
            margin-right: -20px;
            /* padding: -10x -10px -10px -10px; */
            border-top: 2px solid #ccc;
        }

        .tabButton {
            position: relative;
            margin-left: 20px;
            top: -2px;
            cursor: pointer;
            padding: 10px 20px;
            background-color: transparent;
            /* border: none; */
            border-radius: 0px 0px 20px 20px;
            border-width: 0px 1px 1px 1px;
            border-color: #cccccc50;
            border-style: solid;
            /* border-top: 2px solid #ccc; */
            color: #ccc;
        }

        .tabButton.active {
            position: relative;
            border-color: #ccc;
            border-top: 2px solid #000;
            border-width: 2px 2px 2px 2px;
            top: -2px;
        }
        .notification-bar {
            color: white;
            font-family: 'Abel';
            font-weight:700;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background-color: #0000006b;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 26px;
            z-index: 9999;
        }
        .battery-icon {
            margin-right: 10px;
        }

        .power-off-button,
        .beep-disable-button {
            font-size: 20px;
            cursor: pointer;
            border: none;
            background-color: transparent;
        }

       .borderline       
        {
        border-style: solid;
        /* border-width:inherit; */
        border-color: transparent transparent transparent transparent;
        padding: 0%;
        margin:  auto 10%;
        }

        .tab.active .collapsible-content::-ms-scrollbar {
        width: 5px; /* Set the width of the scrollbar */
        background-color: transparent; /* Make the background transparent */
    }


        .tab.active .collapsible-content {
        height: 500px; /* Set the desired height for the scrollable area */
        overflow-y: auto; /* Add vertical scrollbar when content overflows */
        scrollbar-width: thin; /* Width of the scrollbar (Firefox) */
        /* width: 5px; Set the width of the scrollbar */
        background-color: transparent;

        }

        .tab.active .collapsible-content::-webkit-scrollbar-thumb {
        background-color: transparent; /* Make the scrollbar thumb transparent */
    
    }

    .tab.active .collapsible-content::-webkit-scrollbar {
        background-color: transparent; /* Make the scrollbar thumb transparent */
    }
    </style>
</head>

<body>
    <div id="loadingOverlay">
        <div class="loader"></div>
        <img width="380" height="280" src="logo.svg" class="loader-image" alt="SVG Image">
    </div>
    <div id="mainContent" class="timer-controls">
        <div class="notification-bar">
            <button class="beep-disable-button" onclick="timerAction('beepDisable')">
                <span class="glyphicon glyphicon-volume-off"></span>
            </button>
            <span class="battery-percentage" id="batteryPercentage">--</span>
            <button class="power-off-button" onclick="timerAction('powerOff')">
                <span class="glyphicon glyphicon-off"></span>
            </button>
          </div>
          
        <div class="timer-display">
            <div class="timer-info" id="timerInfo">SET 3</div>
        </div>
        <div class="timer-display">
            <div class="timer-value" id="timerValue">00:04</div>
        </div>
        <div class="timer-display">
            <div class="timer-state" id="timerState">GET READY</div>
        </div>
        <div class="timer-buttons">
            <button class="timer-button" id="repeat-icon">
                <span class="glyphicon glyphicon-repeat"></span>
            </button> <!-- Repeat icon -->
            <button class="timer-button" onclick="startTimer()" id="play-icon">
                <span class="glyphicon glyphicon-play"></span>
            </button> <!-- Play icon -->
            <!-- <button class="timer-button" onclick="pauseTimer()" id="pause-icon">&#x23f8;</button> Pause icon -->
            <button class="timer-button" onclick="stopTimer()" id="stop-icon">
                <span class="glyphicon glyphicon-stop"></span>
            </button> <!-- Stop icon -->
        </div>
        <!-- <div id="settingsButton"></div> -->

        <div class="dropup">
            <button id="startPresetButton" class="homebuttons">Start Preset</button>
            <div class="dropup-content" id="startPresetNames">
            </div>
        </div> 

        <button id="settingsButton" class="homebuttons">Settings</button>
        <div id="settingsPanel">
            <div id="tabContent">
                <!-- TAB 1 -->
                <div class="tab active">
                    <h2>Sequence Manager</h2>
                    <div>
                        <h3>Sequence</h3>
                        <ul id="presetList"></ul>
                        <button id="saveSequence" onclick="displaySequenceData()" class="sequnceButtons">Refresh</button>
                        <select id="presetName" class="select-dropdown", class="collapsible-content"  name="presetName" required>
                            <option value="1">Preset 1</option>
                            <option value="2">Preset 2</option>
                            <option value="3">Preset 3</option>
                            <option value="4">Preset 4</option>
                            <option value="5">Preset 5</option>
                            <option value="6">Preset 6</option>
                            <option value="7">Preset 7</option>
                            <option value="8">Preset 8</option>
                            <option value="9">Preset 9</option>
                            <option value="10">Preset 10</option>
                        </select>

                        <div>
                            <button id="addPreset" onclick="addPreset()" class="sequnceButtons">&#8681; Add sequence to &#8681;</button>
                            <select id="sequenceType" class="select-dropdown" name="sequenceType" required>
                                <option value="warmUpSequence">Warmup</option>
                                <option value="basicSequence">Basic</option>
                                <option value="regularSequence">Combo</option>
                            </select>
                        </div>
                        <div>
                            <button id="saveSequence" onclick="saveSequenceData()" class="sequnceButtons">Save Sequence</button>
                        </div>
                    </div>
                </div>
                <!-- TAB 2 -->
                <div class="tab">
                    <form id="timerForm">
                        <h2>Preset Settings</h2>
                        <div class="collapsible-content">
                            <div class="select-dropdown" >
                                <select id="timerName" name="timerName" required>
                                    <option value="0">Select Timer Name</option>
                                    <option value="1">Preset 1</option>
                                    <option value="2">Preset 2</option>
                                    <option value="3">Preset 3</option>
                                    <option value="4">Preset 4</option>
                                    <option value="5">Preset 5</option>
                                    <option value="6">Preset 6</option>
                                    <option value="7">Preset 7</option>
                                    <option value="8">Preset 8</option>
                                    <option value="9">Preset 9</option>
                                    <option value="10">Preset 10</option>
                                </select>
                            </div>
                            <hr>
                            <!-- Initial Countdown Time -->
                            <!-- &#9201;; -->
                            <div class="borderline">
                                <label for="initialCountdownHours">	&#9898; Initial Countdown Time</label>
                                <br>
                                <input type="number" id="initialCountdownHours" onclick="selectText('initialCountdownHours')" name="initialCountdownHours" min="0" onclick="selectText('initialCountdownSeconds')"  step="1" required>
                                <label for="initialCountdownHours">h</label>
                                <input type="number" id="initialCountdownMinutes" onclick="selectText('initialCountdownMinutes')" name="initialCountdownMinutes" min="0" onclick="selectText('initialCountdownSeconds')"  step="1" required>
                                <label for="initialCountdownMinutes">m</label>
                                <input type="number" id="initialCountdownSeconds" onclick="selectText('initialCountdownSeconds')" name="initialCountdownSeconds" min="0" onclick="selectText('initialCountdownSeconds')"  step="1" required>
                                <label for="initialCountdownSeconds">s</label>

                            </div>

                            <!-- Work Time -->
                            <!-- &#127947; -->
                            <div class="borderline">
                                <label for="workTimeHours">&#128308; Work Time</label>
                                <br>
                                <input type="number" id="workTimeHours" name="workTimeHours" min="0" onclick="selectText('workTimeHours')"  step="1" required>
                                <label for="initialCountdownHours">h</label>
                                <input type="number" id="workTimeMinutes" name="workTimeMinutes" min="0" onclick="selectText('workTimeMinutes')"  step="1" required>
                                <label for="initialCountdownMinutes">m</label>
                                <input type="number" id="workTimeSeconds" name="workTimeSeconds" min="0" onclick="selectText('workTimeSeconds')"  step="1" required>
                                <label for="initialCountdownSeconds">s</label>

                            </div>

                            <!-- Rest Time -->
                            <!-- &#128164; -->

                            <div class="borderline">
                                <label for="restTimeHours">&#128994; Rest Time</label>
                                <br>
                                <input type="number" id="restTimeHours" name="restTimeHours" min="0" onclick="selectText('restTimeHours')"  step="1" required>
                                <label for="initialCountdownHours">h</label>
                                <input type="number" id="restTimeMinutes" name="restTimeMinutes" min="0" onclick="selectText('restTimeMinutes')"  step="1" required>
                                <label for="initialCountdownMinutes">m</label>
                                <input type="number" id="restTimeSeconds" name="restTimeSeconds" min="0" onclick="selectText('restTimeSeconds')"  step="1" required>
                                <label for="initialCountdownSeconds">s</label>
                            </div>

                            
                            <!-- Recovery Time -->
                            <!-- &#128164; -->
                            <div class="borderline">
                                <label for="recoveryTimeHours">&#128309; Recovery Time</label>
                                <br>
                                <input type="number" id="recoveryTimeHours" name="recoveryTimeHours" min="0" onclick="selectText('recoveryTimeHours')"  step="1" required>
                                <label for="initialCountdownHours">h</label>
                                <input type="number" id="recoveryTimeMinutes" name="recoveryTimeMinutes" min="0" onclick="selectText('recoveryTimeMinutes')"  step="1" required>
                                <label for="initialCountdownMinutes">m</label>
                                <input type="number" id="recoveryTimeSeconds" name="recoveryTimeSeconds" min="0" onclick="selectText('recoveryTimeSeconds')"  step="1" required>
                                <label for="initialCountdownSeconds">s</label>
                            </div>
                            
                            <!-- Number of Sets -->
                            <!-- &#128101; -->
                            <div class="borderline">
                                <label for="sets">Number of Sets &#9203;</label>
                                <br>
                                <input type="number" id="sets" name="sets" min="0" onclick="selectText('sets')"  step="1" required style="width: 95%;">
                            </div>

                            <!-- Number of Cycles -->
                            <div class="borderline">
                                <label for="cycles">Number of Cycles &#128692;</label>
                                <br>
                                <input type="number" id="cycles" name="cycles" min="0" onclick="selectText('cycles')"  step="1" required style="width: 95%;" >
                                
                            </div>

                            <div class="form-group">
                                <button type="submit" id="saveButton">Save Timer</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tabButtons" id="tabButtons">
                <button class="tabButton active" onclick="switchTab(0)">Sequence</button>
                <button class="tabButton" onclick="switchTab(1)">Preset</button>
            </div>
        </div>
        <script>
            // JavaScript Code
            // Remove zeros in array
            function removeZeros(array) {
                return array.filter((element) => element !== 0);
            }
            // Preset data stored in a JavaScript variable---------------------------------------------------------------
            presetNames = [
                "null",
                "Preset 1",
                "Preset 2",
                "Preset 3",
                "Preset 4",
                "Preset 5",
                "Preset 6",
                "Preset 7",
                "Preset 8",
                "Preset 9",
                "Preset 10",
            ];
            let presetData = {
                warmUpSequence: [],
                basicSequence: [],
                regularSequence : [],
            };
            function toSeconds(hours, minutes, seconds){
                return hours * 3600 + minutes * 60 + seconds;
            }
            function toTime(totalSeconds){
                hours = Math.floor(totalSeconds / 3600);
                totalSeconds %= 3600;
                minutes = Math.floor(totalSeconds / 60);
                seconds = totalSeconds % 60;
                return [hours, minutes, seconds];
            }

            function selectText(textBoxId) {
                const input = document.getElementById(textBoxId);
                input.focus();
                input.select();
            }

            function selectAllInputs(formId) {
                const form = document.getElementById(formId);
                const inputs = form.getElementsByTagName('input');
                for (let i = inputs.length-1; i => 0; i--) {
                    selectText(inputs[i].id);
                }
            }


            function updatePresetNames(presetListId, tagname="option") {
                // Get the <select> element
                const presetNameElement = document.getElementById(presetListId);

                while (presetNameElement.firstChild) {
                    presetNameElement.firstChild.remove();
                }
                // Iterate over the presetNames array and create <option> elements
                presetNames.forEach((presetName, index) => {
                    // Create a new <option> element
                    const optionElement = document.createElement(tagname);

                    // Set the value attribute to the index of the presetNames array
                    optionElement.value = index;

                    // Set the text content to the corresponding preset name
                    optionElement.textContent = presetName;
                    optionElement.setAttribute('data-preset', index);

                    // Append the <option> element to the <select> element
                    presetNameElement.appendChild(optionElement);
                });
            }

            // Start preset------------------------------------------------------------------------
            updatePresetNames("startPresetNames", 'a');
            // Add event listeners to dropup options
            document.querySelectorAll('.dropup-content a').forEach(option => {
                option.addEventListener('click', function() {
                    // Extract the selected preset value from the "data-preset" attribute
                    const presetValue = this.getAttribute('data-preset');

                    // Call the function to start the preset with the selected value
                    console.log(presetValue);
                    sendAjaxRequest('/timerControl?state=run&preset=' + presetValue);

                });
            });

            
            // Sequence tab---------------------------------------------------------------------
            function getSequenceData() {
                // Fetch the JSON data from the /save?info endpoint
                fetch('/save?info')
                    .then(function (response) {
                        return response.json();
                    })
                    .then(function (data) {
                        console.log(data);
                        // Update the values
                        presetData["warmUpSequence"] = data.warmUpSequence
                        presetData["basicSequence"] = data.basicSequence
                        presetData["regularSequence"] = data.regularSequence
                        
                        // Removing zero elements from each array
                        presetData.warmUpSequence = removeZeros(presetData.warmUpSequence);
                        presetData.basicSequence = removeZeros(presetData.basicSequence);
                        presetData.regularSequence = removeZeros(presetData.regularSequence);
                    })
                    .catch(function (error) {
                        console.error('Error fetching JSON:', error);
                    });
            }
            function saveSequenceData(){
                let params = new URLSearchParams();
                // Add the data to the URLSearchParams object
                params.append('warmUpSequence', presetData.warmUpSequence.join(','));
                params.append('basicSequence', presetData.basicSequence.join(','));
                params.append('regularSequence', presetData.regularSequence.join(','));
                let url = '/save?' + params.toString();

                // Create an AJAX request
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/save', true); // Replace "/save" with your server endpoint
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                // Send the form data
                xhr.send(params);

                // Handle the AJAX response
                xhr.onload = function () {
                    if (xhr.status === 200) {
                        // Display a success message
                        closeSettingsPanel();
                    } else {
                        // Display an error message or handle the error
                        alert('Error saving sequence settings.');
                        console.error('Error saving sequence settings.');
                    }
                };
                getSequenceData();
                displaySequenceData();
            }

            // Function to add a new preset
            function addPreset() {
                const presetName = document.getElementById('presetName');
                if (presetName.value !== "0") {
                    var sequenctType = document.getElementById('sequenceType').value;
                    presetData[sequenctType].push(presetName.value);
                    console.log(presetName.value)
                    console.log(presetName)
                    displaySequenceData();
                }
            }
            // Function to delete a preset
            function deleteSequence(index) {
                var sequenctType = document.getElementById('sequenceType').value;
                presetData[sequenctType].splice(index, 1);
                displaySequenceData();
            }
            // Function to edit a preset
            function editPreset(index) {
                const newName = prompt('Enter the new name for the preset:', presetNames[index]);
                if (newName !== null) {
                    presetNames[index] = newName;
                    displaySequenceData();
                }
            }
            function clearSequence(groupName) {
                presetData[groupName] = [];
                displaySequenceData();
            }

            // Function to display the preset data in the UI
            function displaySequenceData() {
                const presetList = document.getElementById('presetList');
                var sequenctType = document.getElementById('sequenceType').value;
                presetList.innerHTML = '';
                presetData[sequenctType].forEach((presetIndex, index) => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `${presetNames[presetIndex]} <button onclick="editPreset(${presetIndex})">&#x270E;</button> <button class="preset-button" onclick="deleteSequence(${index})">&#x2716; </button> `;
                    presetList.appendChild(listItem);
                });
                updatePresetNames("presetName");
            }

            const sequenceTypeElement = document.getElementById("sequenceType");
            sequenceTypeElement.addEventListener("change", displaySequenceData);
            getSequenceData();
            displaySequenceData();


            // Timer controls---------------------------------------------------------------------
            function startTimer() {
                sendAjaxRequest('/timerControl?state=sequence');
            }

            function pauseTimer() {
                sendAjaxRequest('/timerControl?state=pause');
            }

            function stopTimer() {
                sendAjaxRequest('/timerControl?state=stop');
            }

            function sendAjaxRequest(url) {
                var xhttp = new XMLHttpRequest();
                xhttp.open('GET', url, true);
                xhttp.send();
            }


            // Update display---------------------------------------------------------------------
            // Get the timer value element
            var timerValue = document.getElementById('timerValue');
            var timerInfo = document.getElementById('timerInfo');
            var timerState = document.getElementById('timerState');

            var timerIndex = 0;

            // Function to update the timer elements with JSON data
            function updateTimer(json) {
                // Parse the JSON data
                try {
                    // var jsonData = json.trim();
                    var data = JSON.parse(json.trim());

                    // Get the timer elements
                    var timerInfo = document.getElementById('timerInfo');
                    var timerValue = document.getElementById('timerValue');
                    var timerState = document.getElementById('timerState');
                    var timerIndex = document.getElementById('timerName');

                    // Update the timer elements with the data
                    // timerIndex.textContent = data.index;
                    timerInfo.textContent = 'SET ' + data.set;
                    timerValue.textContent = formatTime(data.countDown);
                    timerState.textContent = data.phase;
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                }
            }
            function formatTime(time) {
                var hours = Math.floor(time / 3600);
                var minutes = Math.floor((time % 3600) / 60);
                var seconds = time % 60;

                var formattedTime = '';

                if (hours > 0) {
                    formattedTime += (hours) + ':';
                }
                
                formattedTime += ('0' + minutes).slice(-2) + ':' + ('0' + seconds).slice(-2);
                return formattedTime;
            }           



            function fetchLiveJson() {
                // Fetch the JSON data from the /live endpoint
                fetch('/live')
                    .then(response => response.json())
                    .then(data => updateTimer(JSON.stringify(data)))
                    .catch(error => console.error('Error:', error));
            }
            setInterval(fetchLiveJson, 1000);

            // Update presets---------------------------------------------------------------------
            // Function to update the timerForm inputs based on the selected timerName
            function updateTimerFormInputs() {
                // Get the selected timerName as a number
                var timerIndex = parseInt(document.getElementById('timerName').value);
                // Fetch the JSON data from the /save?info endpoint
                fetch('/save?info')
                    .then(function (response) {
                        return response.json();
                    })
                    .then(function (data) {
                        // Find the corresponding timer object in the JSON data based on the index (timerIndex)
                        var timer = data.timers[timerIndex];

                        let initialCountdown = toTime(timer.initialCountdown);
                        let workTime = toTime(timer.workTime);
                        let restTime = toTime(timer.restTime);
                        let recoveryTime = toTime(timer.recoveryTime);

                        // Update the input values with the timer values
                        document.getElementById('initialCountdownHours').value = initialCountdown[0];
                        document.getElementById('initialCountdownMinutes').value = initialCountdown[1];
                        document.getElementById('initialCountdownSeconds').value = initialCountdown[2];

                        document.getElementById('workTimeHours').value = workTime[0];
                        document.getElementById('workTimeMinutes').value = workTime[1];
                        document.getElementById('workTimeSeconds').value = workTime[2];

                        document.getElementById('restTimeHours').value = restTime[0];
                        document.getElementById('restTimeMinutes').value = restTime[1];
                        document.getElementById('restTimeSeconds').value = restTime[2];

                        document.getElementById('recoveryTimeHours').value = recoveryTime[0];
                        document.getElementById('recoveryTimeMinutes').value = recoveryTime[1];
                        document.getElementById('recoveryTimeSeconds').value = recoveryTime[2];

                        document.getElementById('sets').value = timer.sets;
                        document.getElementById('cycles').value = timer.cycles;

                        selectAllInputs('timerForm');
                    })
                    .catch(function (error) {
                        console.error('Error fetching JSON:', error);
                    });
            }

            // Function to handle the page load
            function handlePageLoad() {
                // Fetch the JSON data from the /live endpoint to get the timerName value
                fetch('/live')
                    .then(function (response) {
                        return response.json();
                    })
                    .then(function (data) {
                        console.log(data);
                        var timerName = document.getElementById('timerName');
                        // Get the timerName value from the JSON data
                        timerName.selectedIndex = parseInt(data.preset);
                        console.log(data.preset);

                        
                        // Update the timerForm inputs based on the timerName value
                        updateTimerFormInputs();
                    })
                    .catch(function (error) {
                        console.error('Error fetching JSON:', error);
                    });
            }

            // Event listener for the page load
            window.addEventListener('load', handlePageLoad);

            // Event listener for the timerName change
            document.getElementById('timerName').addEventListener('change', updateTimerFormInputs);



            // Bacground animation---------------------------------------------------------------------
            // Get the body element
            var body = document.querySelector("body");
            // Update the timer value every second
            var counter = 0;
            setInterval(function () {
                counter++;
                // updateTimerDisplay(counter);
                body.style.background = "linear-gradient(" + counter * 3.14 + "deg, #ff0000, #000000)";
            }, 100); // Update every second (1000 milliseconds)

            // on window loaded--------------------------------------------------------------------------------------------
            window.addEventListener('DOMContentLoaded', function () {
                // Timer form dubmit--------------------------------------------------------------------------
                // Get the form element
                var form = document.getElementById('timerForm');

                // Add event listener to the form submit event
                form.addEventListener('submit', function (e) {
                    e.preventDefault(); // Prevent form submission
                    // Call a function to handle the form data
                    
                    // Get values for Initial Countdown Time
                    const initialCountdownHours = parseInt(document.getElementById("initialCountdownHours").value);
                    const initialCountdownMinutes = parseInt(document.getElementById("initialCountdownMinutes").value);
                    const initialCountdownSeconds = parseInt(document.getElementById("initialCountdownSeconds").value);
                    // Get values for Work Time
                    const workTimeHours = parseInt(document.getElementById("workTimeHours").value);
                    const workTimeMinutes = parseInt(document.getElementById("workTimeMinutes").value);
                    const workTimeSeconds = parseInt(document.getElementById("workTimeSeconds").value);
                    // Get values for Rest Time
                    const restTimeHours = parseInt(document.getElementById("restTimeHours").value);
                    const restTimeMinutes = parseInt(document.getElementById("restTimeMinutes").value);
                    const restTimeSeconds = parseInt(document.getElementById("restTimeSeconds").value);
                    // Get values for Recovery Time
                    const recoveryTimeHours = parseInt(document.getElementById("recoveryTimeHours").value);
                    const recoveryTimeMinutes = parseInt(document.getElementById("recoveryTimeMinutes").value);
                    const recoveryTimeSeconds = parseInt(document.getElementById("recoveryTimeSeconds").value);

                    const timerName = document.getElementById("timerName").value;
                    const initialCountdown = toSeconds(initialCountdownHours, initialCountdownMinutes, initialCountdownSeconds);
                    const workTime = toSeconds(workTimeHours, workTimeMinutes, workTimeSeconds);
                    const restTime = toSeconds(restTimeHours, restTimeMinutes, restTimeSeconds);
                    const sets = document.getElementById("sets").value;
                    const recoveryTime = toSeconds(recoveryTimeHours, recoveryTimeMinutes, recoveryTimeSeconds);                    
                    const cycles = document.getElementById("cycles").value;

                    // Get the form data
                    // Create an object with the form data
                    var formData = {
                        timerName: timerName,
                        initialCountdown: initialCountdown,
                        workTime: workTime,
                        restTime: restTime,
                        sets: sets,
                        recoveryTime: recoveryTime,
                        cycles: cycles,
                    };
                    console.log(formData);
                    // var formData = new FormData(form);

                    // Create an AJAX request
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', '/save', true); // Replace "/save" with your server endpoint
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                    // Send the form data
                    xhr.send(new URLSearchParams(formData));

                    // Handle the AJAX response 
                    xhr.onload = function () {
                        if (xhr.status === 200) {
                            // Display a success message
                            closeSettingsPanel();
                            // alert('Done');
                        } else {
                            // Display an error message or handle the error
                            alert('Error saving timer settings.');
                            console.error('Error saving timer settings.');
                        }

                    };

                });


                // Boot Animaition---------------------------------------------------------------------
                // Select the loading overlay and main content
                const loadingOverlay = document.getElementById('loadingOverlay');
                const mainContent = document.getElementById('mainContent');

                // Show the main content after the fade-out animation completes
                setTimeout(function () {
                    // Add a CSS class to trigger the fade-out transition
                    loadingOverlay.classList.add('fade-out');

                    // Show the main content after the fade-out animation completes
                    setTimeout(function () {
                        // Hide the loading overlay
                        loadingOverlay.style.opacity = 0;
                        loadingOverlay.parentNode.removeChild(loadingOverlay);

                        // Show the main content
                        mainContent.style.opacity = 1;
                    }, 500); // Adjust the duration as needed
                }, 1000);
            });

            // Bottom Settings---------------------------------------------------------------------
            // Variables to track the dragging behavior
            let isDragging = false;
            let startOffsetY = 0;
            let currentOffsetY = 0;
            let settingsPanel = document.getElementById('settingsPanel');

            // Function to handle the button drag
            function handleDrag(event) {
                if (!isDragging) return;

                currentOffsetY = startOffsetY - event.clientY;

                if (currentOffsetY < 0) currentOffsetY = 0;
                if (currentOffsetY > settingsPanel.offsetHeight) currentOffsetY = settingsPanel.offsetHeight;

                settingsPanel.style.bottom = `${currentOffsetY}px`;
            }

            // Function to handle the start of dragging
            function startDrag(event) {
                isDragging = true;
                startOffsetY = settingsPanel.offsetHeight - event.clientY;
            }

            // Function to handle the end of dragging
            function endDrag() {
                if (isDragging) {
                    isDragging = false;

                    // If dragged less than 30% of the panel height, close the settings panel
                    if (currentOffsetY < settingsPanel.offsetHeight * 0.3) {
                        settingsPanel.style.bottom = `-${settingsPanel.offsetHeight}px`;
                    }
                }
            }


            // Function to close the settings panel
            function closeSettingsPanel() {
            // Get a reference to the settings panel element
            const settingsPanel = document.getElementById('settingsPanel');

            // Close the panel if it is open
            if (settingsPanel.classList.contains('open')) {
                settingsPanel.style.bottom = `-${settingsPanel.offsetHeight}px`;
                settingsPanel.classList.remove('open');
            }
            }

            // Function to toggle the settings panel
            function toggleSettingsPanel(event) {
            // Stop the event from propagating to the parent elements
            event.stopPropagation();

            // Get a reference to the settings panel element
            const settingsPanel = document.getElementById('settingsPanel');

            // Toggle the panel state
            if (settingsPanel.classList.contains('open')) {
                closeSettingsPanel(); // Call the closeSettingsPanel() function
            } else {
                settingsPanel.style.bottom = '0';
                settingsPanel.classList.add('open');
            }
            }

            // Event listener for the settings button click
            document.getElementById('settingsButton').addEventListener('click', toggleSettingsPanel);

            // Event listeners for dragging behavior
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', endDrag);
            document.getElementById('settingsButton').addEventListener('mousedown', startDrag);


            // Event listener to close the settings panel when clicking outside of it
            document.addEventListener('click', function (event) {
                // if (settingsPanel.classList.contains('open')) {
                if (!settingsPanel.contains(event.target) && !event.target.classList.contains('settings-button')) {
                    // Clicked outside the settings panel and not on the settings button, so close the panel
                    settingsPanel.style.bottom = `-${settingsPanel.offsetHeight}px`;
                    settingsPanel.classList.remove('open');
                }
            });

            // Switching tabs---------------------------------------------------------------------

            function switchTab(tabIndex) {
                // Get all tab buttons and tab content elements
                const tabButtons = document.querySelectorAll('.tabButton');
                const tabs = document.querySelectorAll('.tab');

                // Remove the 'active' class from all tab buttons and tabs
                tabButtons.forEach((button) => {
                    button.classList.remove('active');
                });
                tabs.forEach((tab) => {
                    tab.classList.remove('active');
                });

                // Add the 'active' class to the clicked tab button and corresponding tab
                tabButtons[tabIndex].classList.add('active');
                tabs[tabIndex].classList.add('active');
            }
            // Notification bar------------------------------------------
            function updateNotificationBar(){
                // Fetch the JSON data from the /save?info endpoint
                fetch('/info?info')
                    .then(function (response) {
                        return response.json();
                    })
                    .then(function (data) {
                        console.log(data);
                        updateBatteryPercentage(data.getBattery);
                    })
                    .catch(function (error) {
                        console.error('Error fetching JSON:', error);
                    });
            }
            function updateBatteryPercentage(percentage) {
                const batteryPercentageElement = document.getElementById('batteryPercentage');
                batteryPercentageElement.textContent = percentage + '%';
            }
            setInterval(updateNotificationBar, 3000);
            
            function timerAction(actionString) {
                console.log('/info?' + actionString);
                sendAjaxRequest('/info?' + actionString);
                // if(actionString == "powerOff")window.close();
            }

        </script>
</body>

</html>